stages:
    - configure
    - build

default:
  image: registry.gitlab.com/tiburoch/cracklet

.configure:
    stage: configure
    except:
        - tags
    script:
        - cmake -DCRACKLET_MULTI_THREADED:BOOL=TRUE

.build:
    stage: build
    script:
        - cmake --build build/src > >(tee -a ${output}-out.log) 2> >(tee -a ${output}-err.log >&2)

configure:ubuntu:
    extends:
        - .configure
    cache:
        policy: pull-push

build:ubuntu:
    extends:
        - .build
    dependencies:
        - configure:ubuntu