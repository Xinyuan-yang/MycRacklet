stages:
    - configure
    - build

default:
  image: registry.gitlab.com/tiburoch/cracklet

.configure:
    stage: configure
    except:
        - tags
    script:
        - cmake -E make_directory build
        - cd build
        - cmake -DCMAKE_BUILD_TYPE:STIRNG=Release ..
    artifacts:
        when: on_success
        paths:
          - build
        expire_in: 10h

.build:
    stage: build
    script:
        - cmake --build build/src > >(tee -a ubuntu-out.log) 2> >(tee -a ubuntu-err.log >&2)

configure:ubuntu:
    extends:
        - .configure
    cache:
        policy: pull-push

build:ubuntu:
  extends:
    - .build
  dependencies:
    - configure:ubuntu